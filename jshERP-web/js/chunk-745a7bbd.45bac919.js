(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-745a7bbd"],{"267bb":function(t,e,n){"use strict";n.r(e),n.d(e,"FinancialModalMixin",(function(){return l}));var i=n("4ec3"),o=n("0fea"),a=n("ca00"),r=(n("9fb0"),n("2b0e"));function s(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=c(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,o=function(){};return{s:o,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return r=t.done,t},e:function(t){s=!0,a=t},f:function(){try{r||null==n.return||n.return()}finally{if(s)throw a}}}}function c(t,e){if(t){if("string"==typeof t)return u(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(t,e):void 0}}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}var l={data:function(){return{action:"",actionWithOrgan:!1,supList:[],cusList:[],retailList:[],organList:[],personList:[],accountList:[],billStatus:"0",isCanCheck:!0,quickBtn:{vendor:!1,customer:!1,account:!1,person:!1,inOutItem:!1},checkFlag:!0,spans:{labelCol1:{span:2},wrapperCol1:{span:22},labelCol1_5:{span:3},wrapperCol1_5:{span:21},labelCol2:{span:4},wrapperCol2:{span:20},labelCol3:{span:6},wrapperCol3:{span:18},labelCol6:{span:12},wrapperCol6:{span:12}}}},created:function(){var t=window.screen.width;this.width=t<1500?"1200px":"1550px",this.minWidth=t<1500?1150:1500},mounted:function(){document.getElementById(this.prefixNo).addEventListener("keydown",this.handleOkKey)},beforeDestroy:function(){document.getElementById(this.prefixNo).removeEventListener("keydown",this.handleOkKey)},computed:{readOnly:function(){return"add"!==this.action&&"edit"!==this.action}},methods:{handleOkKey:function(t){var e=window.event.keyCode?window.event.keyCode:window.event.which;83===e&&t.ctrlKey&&(this.handleOk(),t.preventDefault())},addInit:function(t){var e=this;Object(o["d"])("/sequence/buildNumber").then((function(n){n&&200===n.code&&e.form.setFieldsValue({billNo:t+n.data.defaultNumber})})),this.$nextTick((function(){e.form.setFieldsValue({billTime:Object(a["j"])(),totalPrice:0,discountMoney:0,changeAmount:0})})),this.$nextTick((function(){Object(i["eb"])({}).then((function(t){if(t&&200===t.code){var n,i=s(t.data.accountList);try{for(i.s();!(n=i.n()).done;){var o=n.value;o.isDefault&&e.form.setFieldsValue({accountId:o.id})}}catch(a){i.e(a)}finally{i.f()}}}))}))},initSystemConfig:function(){var t=this;Object(i["ib"])().then((function(e){if(200===e.code&&e.data){var n=e.data.multiBillType,i=e.data.multiLevelApprovalFlag;t.checkFlag=Object(a["g"])(n,i,t.prefixNo)}}))},initSupplier:function(){var t=this;Object(i["ab"])({}).then((function(e){e&&(t.supList=e)}))},initCustomer:function(){var t=this;Object(i["X"])({}).then((function(e){e&&(t.cusList=e)}))},initOrgan:function(){var t=this;Object(i["Y"])({}).then((function(e){e&&(t.organList=e)}))},initRetail:function(){var t=this;Object(i["Z"])({}).then((function(e){e&&(t.retailList=e)}))},initPerson:function(){var t=this;Object(i["sb"])({type:"财务员"}).then((function(e){e&&200===e.code&&(t.personList=e.data.personList)}))},initInOutItem:function(t){var e=this;Object(i["cb"])({type:t}).then((function(t){if(t){var n,i=s(e.accountTable.columns);try{for(i.s();!(n=i.n()).done;){var o=n.value;if("inOutItemId"==o.key){o.options=[];for(var a=0;a<t.length;a++){var r={};r.value=t[a].id+"",r.text=t[a].name,r.title=t[a].name,o.options.push(r)}}}}catch(c){i.e(c)}finally{i.f()}}}))},initAccount:function(){var t=this;Object(i["eb"])({}).then((function(e){e&&200===e.code&&(t.accountList=e.data.accountList)}))},initDetailAccount:function(){var t=this;Object(i["eb"])({}).then((function(e){if(e&&200===e.code){var n,i=e.data.accountList,o=s(t.accountTable.columns);try{for(o.s();!(n=o.n()).done;){var a=n.value;if("accountId"==a.key){a.options=[];for(var r=0;r<i.length;r++){var c={};c.value=i[r].id+"",c.text=i[r].name,c.title=i[r].name,a.options.push(c)}}}}catch(u){o.e(u)}finally{o.f()}}}))},onChangeOrgan:function(t){this.accountTable.dataSource=[]},addSupplier:function(){this.$refs.vendorModalForm.add(),this.$refs.vendorModalForm.title="新增",this.$refs.vendorModalForm.disableSubmit=!1},addCustomer:function(){this.$refs.customerModalForm.add(),this.$refs.customerModalForm.title="新增客户（提醒：如果找不到新添加的客户，请到用户管理检查是否分配了该客户权限）",this.$refs.customerModalForm.disableSubmit=!1},addAccount:function(){this.$refs.accountModalForm.add(),this.$refs.accountModalForm.title="新增结算账户",this.$refs.accountModalForm.disableSubmit=!1},addPerson:function(){this.$refs.personModalForm.add(),this.$refs.personModalForm.title="新增经手人",this.$refs.personModalForm.disableSubmit=!1},addInOutItem:function(t){this.$refs.inOutItemModalForm.add(t),this.$refs.inOutItemModalForm.title="新增收支项目",this.$refs.inOutItemModalForm.disableSubmit=!1},vendorModalFormOk:function(){this.initSupplier()},customerModalFormOk:function(){this.initCustomer()},accountModalFormOk:function(){this.initAccount()},personModalFormOk:function(){this.initPerson()},inOutItemModalFormOk:function(t){this.initInOutItem(t)},workflowModalFormOk:function(){this.close()},waitNeedListOk:function(t,e,n){e&&this.form.setFieldsValue({organId:e}),n&&n.length>0?this.requestSubTableDataEx(n,this.accountTable):this.selectBeginNeed(t)},onAdded:function(t){var e=this,n=(t.row,t.target);setTimeout((function(){e.$refs.accountDataTable.resetScrollTop((n.rows.length+1)*e.$refs.accountDataTable.rowHeight)}),1e3)},onDeleted:function(t,e){e.recalcAllStatisticsColumns(),this.autoChangeAmount(e)},onValueChange:function(t){var e=this,n=(t.type,t.row,t.column),i=(t.value,t.target);switch(n.key){case"eachAmount":i.recalcAllStatisticsColumns(),e.autoChangeAmount(i);break}},autoChangeAmount:function(t){var e=this,n=t.statisticsColumns.eachAmount-0,i=this.form.getFieldValue("discountMoney")-0;i||(i=0);var o=(n-i).toFixed(2);this.$nextTick((function(){e.form.setFieldsValue({totalPrice:n,changeAmount:o})}))},onChangeDiscountMoney:function(t){var e=this,n=t.target.value-0,i=this.form.getFieldValue("totalPrice")-0,o=(i-n).toFixed(2);this.$nextTick((function(){e.form.setFieldsValue({changeAmount:o})}))},debtBillListOk:function(t){t&&t.length>0&&this.requestSubTableDataEx(t,this.accountTable)},requestSubTableDataEx:function(t,e,n){var i=this;e.loading=!0;for(var o=[],a=0,r=0;r<t.length;r++){var s=t[r];s.billNumber=s.number,s.needDebt=s.needDebt,s.eachAmount=s.debt,0!=s.eachAmount&&(a+=s.eachAmount-0,o.push(s))}e.dataSource=o,this.$nextTick((function(){i.form.setFieldsValue({totalPrice:a.toFixed(2),changeAmount:a.toFixed(2)})})),"function"===typeof n&&n(res),e.loading=!1},selectBeginNeed:function(t){var e=this,n="供应商"===t?"付款":"收款",i=this.form.getFieldValue("organId");i?this.$confirm({title:"确认操作",content:"是否选择期初金额，对期初进行"+n+"?",onOk:function(){var t=[],n={billNumber:"QiChu"};Object(o["d"])("/supplier/getBeginNeedByOrganId",{organId:i}).then((function(i){if(200===i.code){n.needDebt=i.data.needDebt?i.data.needDebt:0,n.finishDebt=i.data.finishDebt,n.eachAmount=i.data.eachAmount,t.push(n),e.accountTable.dataSource=t;var o=n.eachAmount;o&&(o=o.toFixed(2)),e.$nextTick((function(){e.form.setFieldsValue({totalPrice:o,changeAmount:o})}))}else e.$message.info(i.data)}))}}):e.$message.warning("请选择"+t+"！")},handleWaitNeed:function(t){this.$refs.waitNeedList.show(t)},handleOkAndCheck:function(){this.billStatus="1",this.handleOk()},handleWorkflow:function(){var t=this;this.model&&this.model.billNo?Object(i["tb"])({platformKey:"send_workflow_url"}).then((function(e){if(e&&200===e.code){var n=e.data.platformValue+"&no="+t.model.billNo+"&type=2";t.$refs.modalWorkflow.show(t.model,n,t.model.billNo,2,320),t.$refs.modalWorkflow.title="发起流程"}})):this.$message.warning("请先保存单据后再提交流程！")},initQuickBtn:function(){var t=r["a"].ls.get("winBtnStrList");if(t)for(var e=0;e<t.length;e++)t[e].btnStr&&(this.quickBtn.vendor="/system/vendor"===t[e].url?t[e].btnStr.indexOf(1)>-1:this.quickBtn.vendor,this.quickBtn.customer="/system/customer"===t[e].url?t[e].btnStr.indexOf(1)>-1:this.quickBtn.customer,this.quickBtn.account="/system/account"===t[e].url?t[e].btnStr.indexOf(1)>-1:this.quickBtn.account,this.quickBtn.person="/system/person"===t[e].url?t[e].btnStr.indexOf(1)>-1:this.quickBtn.person,this.quickBtn.inOutItem="/system/in_out_item"===t[e].url?t[e].btnStr.indexOf(1)>-1:this.quickBtn.inOutItem)}}}}}]);